<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.team_manage.mapper.AttendanceInfoMapper">

    <select id="attendanceInfoPageByQry" resultType="com.team_manage.controller.attendanceinfo.vo.AttendanceInfoVO">
        SELECT
        ai.player_id,
        ai.attendance_year,
        ai.attendance_month,
        sum(ai.sick_leave_day) as sick_leave_day,
        sum(ai.absenteeism_day) as absenteeism_day,
        sum(ai.personal_leave_day) as personal_leave_day,
        pi.player_name
        FROM
        attendance_info  ai

        ai.delete_flag = 0
        <if test="qry.userName != null and qry.userName != ''">
            AND pi.user_name LIKE CONCAT('%' , #{qry.userName}, '%')
        </if>
        <if test="qry.selectYear != null and qry.selectYear != ''">
            AND ni.attendance_year  = {qry.selectYear}
        </if>
        <if test="qry.selectMonth != null and qry.selectMonth != ''">
            AND ni.attendance_month  = {qry.selectMonth}
        </if>
        GROUP BY ai.player_id
        ORDER BY ai.attendance_year,ai.attendance_month DESC
    </select>
</mapper>
